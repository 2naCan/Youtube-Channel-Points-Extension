console.log("Background Service Worker Loaded");chrome.runtime.onInstalled.addListener(async()=>{console.log("Extension installed")});chrome.action.setBadgeText({text:"ON"});chrome.action.onClicked.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{const t=e[0];chrome.tabs.sendMessage(t.id,{message:"clicked_browser_action"})})});chrome.commands.onCommand.addListener(e=>{console.log(`Command: ${e}`),e==="refresh_extension"&&chrome.runtime.reload()});let c=0;const r="https://ueeyvn.buildship.run/logWatchTime";chrome.runtime.onMessage.addListener(async(e,t,d)=>{const o=Date.now();if(o-c>2e3){if(c=o,e.type==="updateWatchTime"){const{watchTime:n,author:s,userId:a,wallet:i}=e.payload;console.log("Wallet Received",JSON.stringify(i,null,2)),console.log("Watch Time Update Received:",{watchTime:n,author:s,userId:a}),await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a,author:s,watch_time:n,wallet_address:i.address})}),console.log("Data sent to DB")}}else console.log("Skipping update, too frequent.")});
