import{getAddress as e}from"@ethersproject/address";import{createContext as t,useEffect as i,useContext as r}from"react";function a(e){return e?new Date(1e3*e):null}function s(e,t){return e.slice().sort(((e,t)=>(t.firstVerifiedAt??t.verifiedAt).getTime()-(e.firstVerifiedAt??e.verifiedAt).getTime())).find((e=>e.type===t))}const l=e=>e?.linkedAccounts.find((e=>"wallet"===e.type&&"privy"===e.walletClientType&&!e.imported&&"ethereum"===e.chainType&&0===e.walletIndex))||null,n=e=>e?.linkedAccounts.filter((e=>"wallet"===e.type&&"privy"===e.walletClientType&&!e.imported&&"ethereum"===e.chainType)),d=e=>e?.linkedAccounts.find((e=>"wallet"===e.type&&"privy"===e.walletClientType&&!e.imported&&"solana"===e.chainType&&0===e.walletIndex))||null,o=e=>e?.linkedAccounts.find((e=>"wallet"===e.type&&"privy"===e.walletClientType&&e.imported&&"ethereum"===e.chainType))||null,f=(t,i)=>{let r=(a=t,a?.linkedAccounts.filter((e=>"wallet"===e.type&&"privy"===e.walletClientType&&"ethereum"===e.chainType))).find((t=>e(t.address)===e(i)));var a;return{signingWallet:r,rootWallet:r?r.imported?r:l(t):void 0}};const u=(e,t)=>!(l(e)||d(e)||"all-users"!==t&&("users-without-wallets"!==t||(e=>e.linkedAccounts.filter((e=>"wallet"===e.type)))(e)?.length));function c(e){if(!e)return null;let t=function(e){let t=[];for(let i of e){let e=i.type;switch(i.type){case"wallet":let r={address:i.address,type:i.type,imported:i.imported,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at),chainType:i.chain_type,chainId:i.chain_id,walletClient:"privy"===i.wallet_client_type?"privy":"unknown",walletClientType:i.wallet_client_type,connectorType:i.connector_type,recoveryMethod:i.recovery_method,walletIndex:i.wallet_index};t.push(r);break;case"smart_wallet":let s={address:i.address,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at),smartWalletType:i.smart_wallet_type};t.push(s);break;case"cross_app":let l={type:i.type,subject:i.subject,embeddedWallets:i.embedded_wallets,smartWallets:i.smart_wallets,providerApp:{id:i.provider_app_id},verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(l);break;case"email":let n={address:i.address,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(n);break;case"phone":let d={number:i.phoneNumber,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(d);break;case"google_oauth":let o={subject:i.subject,email:i.email,name:i.name,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(o);break;case"spotify_oauth":let f={subject:i.subject,email:i.email,name:i.name,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(f);break;case"instagram_oauth":let u={subject:i.subject,username:i.username,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(u);break;case"twitter_oauth":let c={subject:i.subject,username:i.username,name:i.name,type:i.type,profilePictureUrl:i.profile_picture_url,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(c);break;case"discord_oauth":let p={subject:i.subject,username:i.username,email:i.email,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(p);break;case"github_oauth":let _={subject:i.subject,username:i.username,name:i.name,email:i.email,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(_);break;case"tiktok_oauth":let m={subject:i.subject,username:i.username,name:i.name,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(m);break;case"linkedin_oauth":let y={subject:i.subject,name:i.name,email:i.email,vanityName:i.vanity_name,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(y);break;case"apple_oauth":let v={subject:i.subject,email:i.email,type:i.type,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(v);break;case"custom_auth":t.push({type:i.type,customUserId:i.custom_user_id,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)});break;case"farcaster":let h={type:i.type,fid:i.fid,ownerAddress:i.owner_address,displayName:i.display_name,username:i.username,bio:i.bio,pfp:i.profile_picture_url,url:i.homepage_url,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at),signerPublicKey:i.signer_public_key};t.push(h);break;case"passkey":let A={type:i.type,enrolledInMfa:i.enrolled_in_mfa,credentialId:i.credential_id,authenticatorName:i.authenticator_name,createdWithDevice:i.created_with_device,createdWithOs:i.created_with_os,createdWithBrowser:i.created_with_browser,verifiedAt:a(i.verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(A);break;case"telegram":let b={type:i.type,telegramUserId:i.telegram_user_id,firstName:i.first_name,lastName:i.last_name,username:i.username,photoUrl:i.photo_url,verifiedAt:a(i.first_verified_at),firstVerifiedAt:a(i.first_verified_at),latestVerifiedAt:a(i.latest_verified_at)};t.push(b);break;default:console.warn(`Unrecognized account type: ${e}. Please consider upgrading the Privy SDK.`)}}return t}(e.linked_accounts),i=s(t,"wallet"),r=s(t,"smart_wallet"),l=s(t,"email"),n=s(t,"phone"),d=s(t,"google_oauth"),o=s(t,"twitter_oauth"),f=s(t,"discord_oauth"),u=s(t,"github_oauth"),c=s(t,"spotify_oauth"),p=s(t,"instagram_oauth"),_=s(t,"tiktok_oauth"),m=s(t,"linkedin_oauth"),y=s(t,"apple_oauth"),v=s(t,"farcaster"),h=s(t,"telegram"),A=e.mfa_methods.map((({type:e,verified_at:t})=>({type:e,verifiedAt:a(t)})));return{id:e.id,createdAt:a(e.created_at),linkedAccounts:t,email:l&&{address:l?.address},phone:n&&{number:n?.number},wallet:i&&{address:i.address,chainType:i.chainType,chainId:i.chainId,walletClient:i.walletClient,walletClientType:i.walletClientType,connectorType:i.connectorType,recoveryMethod:i.recoveryMethod,imported:i.imported,walletIndex:i.walletIndex},smartWallet:r&&{address:r.address,smartWalletType:r.smartWalletType},google:d&&{subject:d.subject,email:d.email,name:d.name},twitter:o&&{subject:o.subject,username:o.username,name:o.name,profilePictureUrl:o.profilePictureUrl},discord:f&&{subject:f.subject,username:f.username,email:f.email},github:u&&{subject:u.subject,username:u.username,name:u.name,email:u.email},spotify:c&&{subject:c.subject,email:c.email,name:c.name},instagram:p&&{subject:p.subject,username:p.username},tiktok:_&&{subject:_.subject,username:_.username,name:_.name},linkedin:m&&{subject:m.subject,name:m.name,email:m.email,vanityName:m.vanityName},apple:y&&{subject:y.subject,email:y.email},farcaster:v&&{fid:v.fid,ownerAddress:v.ownerAddress,displayName:v.displayName,username:v.username,bio:v.bio,pfp:v.pfp,url:v.url,signerPublicKey:v.signerPublicKey},telegram:h&&{telegramUserId:h.telegramUserId,firstName:h.firstName,lastName:h.lastName,username:h.username,photoUrl:h.photoUrl},mfaMethods:A.map((e=>e.type)),hasAcceptedTerms:e.has_accepted_terms??!1,isGuest:e.is_guest,customMetadata:e.custom_metadata}}const p={login:{onComplete:[],onError:[],onOAuthLoginComplete:[]},logout:{onSuccess:[]},connectWallet:{onSuccess:[],onError:[]},createWallet:{onSuccess:[],onError:[]},linkAccount:{onSuccess:[],onError:[]},update:{onSuccess:[],onError:[]},configureMfa:{onMfaRequired:[]},setWalletPassword:{onSuccess:[],onError:[]},setWalletRecovery:{onSuccess:[],onError:[]},signMessage:{onSuccess:[],onError:[]},signTypedData:{onSuccess:[],onError:[]},sendTransaction:{onSuccess:[],onError:[]},sendSolanaTransaction:{onSuccess:[],onError:[]},accessToken:{onAccessTokenGranted:[],onAccessTokenRemoved:[]},oAuthAuthorization:{onOAuthTokenGrant:[]},fundWallet:{onUserExited:[]},fundSolanaWallet:{onUserExited:[]},customAuth:{onAuthenticated:[],onUnauthenticated:[]}},_=t(void 0);let m=()=>r(_);function y(e,t){if(!t)return;let r=m().current[e];return i((()=>{for(let[i,a]of Object.entries(t))r.hasOwnProperty(i)||console.warn(`Invalid event type "${i}" for action "${e}"`),r[i]?.push(a);return()=>{for(let[i,a]of Object.entries(t))r.hasOwnProperty(i)||console.warn(`Invalid event type "${i}" for action "${e}"`),r[i]=r[i]?.filter((e=>e!==a))}}),[t])}function v(e,t,i,...r){for(let a of e.current[t][i])a(...r)}function h(){let e=m();return(t,i,...r)=>v(e,t,i,...r)}export{_ as P,d as a,h as b,c,o as d,v as e,n as f,l as g,f as h,p,u as s,y as u};
