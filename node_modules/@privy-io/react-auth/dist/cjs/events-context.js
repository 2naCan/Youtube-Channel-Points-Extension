"use strict";var e=require("@ethersproject/address"),t=require("react");function i(e){return e?new Date(1e3*e):null}function r(e,t){return e.slice().sort(((e,t)=>(t.firstVerifiedAt??t.verifiedAt).getTime()-(e.firstVerifiedAt??e.verifiedAt).getTime())).find((e=>e.type===t))}const a=e=>e?.linkedAccounts.find((e=>"wallet"===e.type&&"privy"===e.walletClientType&&!e.imported&&"ethereum"===e.chainType&&0===e.walletIndex))||null,s=e=>e?.linkedAccounts.find((e=>"wallet"===e.type&&"privy"===e.walletClientType&&!e.imported&&"solana"===e.chainType&&0===e.walletIndex))||null;const l=t.createContext(void 0);let n=()=>t.useContext(l);function d(e,t,i,...r){for(let a of e.current[t][i])a(...r)}exports.PrivyEventsContext=l,exports.convertUserResponseToUser=function(e){if(!e)return null;let t=function(e){let t=[];for(let r of e){let e=r.type;switch(r.type){case"wallet":let a={address:r.address,type:r.type,imported:r.imported,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at),chainType:r.chain_type,chainId:r.chain_id,walletClient:"privy"===r.wallet_client_type?"privy":"unknown",walletClientType:r.wallet_client_type,connectorType:r.connector_type,recoveryMethod:r.recovery_method,walletIndex:r.wallet_index};t.push(a);break;case"smart_wallet":let s={address:r.address,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at),smartWalletType:r.smart_wallet_type};t.push(s);break;case"cross_app":let l={type:r.type,subject:r.subject,embeddedWallets:r.embedded_wallets,smartWallets:r.smart_wallets,providerApp:{id:r.provider_app_id},verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(l);break;case"email":let n={address:r.address,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(n);break;case"phone":let d={number:r.phoneNumber,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(d);break;case"google_oauth":let o={subject:r.subject,email:r.email,name:r.name,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(o);break;case"spotify_oauth":let u={subject:r.subject,email:r.email,name:r.name,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(u);break;case"instagram_oauth":let f={subject:r.subject,username:r.username,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(f);break;case"twitter_oauth":let c={subject:r.subject,username:r.username,name:r.name,type:r.type,profilePictureUrl:r.profile_picture_url,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(c);break;case"discord_oauth":let p={subject:r.subject,username:r.username,email:r.email,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(p);break;case"github_oauth":let m={subject:r.subject,username:r.username,name:r.name,email:r.email,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(m);break;case"tiktok_oauth":let _={subject:r.subject,username:r.username,name:r.name,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(_);break;case"linkedin_oauth":let v={subject:r.subject,name:r.name,email:r.email,vanityName:r.vanity_name,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(v);break;case"apple_oauth":let y={subject:r.subject,email:r.email,type:r.type,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(y);break;case"custom_auth":t.push({type:r.type,customUserId:r.custom_user_id,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)});break;case"farcaster":let h={type:r.type,fid:r.fid,ownerAddress:r.owner_address,displayName:r.display_name,username:r.username,bio:r.bio,pfp:r.profile_picture_url,url:r.homepage_url,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at),signerPublicKey:r.signer_public_key};t.push(h);break;case"passkey":let A={type:r.type,enrolledInMfa:r.enrolled_in_mfa,credentialId:r.credential_id,authenticatorName:r.authenticator_name,createdWithDevice:r.created_with_device,createdWithOs:r.created_with_os,createdWithBrowser:r.created_with_browser,verifiedAt:i(r.verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(A);break;case"telegram":let b={type:r.type,telegramUserId:r.telegram_user_id,firstName:r.first_name,lastName:r.last_name,username:r.username,photoUrl:r.photo_url,verifiedAt:i(r.first_verified_at),firstVerifiedAt:i(r.first_verified_at),latestVerifiedAt:i(r.latest_verified_at)};t.push(b);break;default:console.warn(`Unrecognized account type: ${e}. Please consider upgrading the Privy SDK.`)}}return t}(e.linked_accounts),a=r(t,"wallet"),s=r(t,"smart_wallet"),l=r(t,"email"),n=r(t,"phone"),d=r(t,"google_oauth"),o=r(t,"twitter_oauth"),u=r(t,"discord_oauth"),f=r(t,"github_oauth"),c=r(t,"spotify_oauth"),p=r(t,"instagram_oauth"),m=r(t,"tiktok_oauth"),_=r(t,"linkedin_oauth"),v=r(t,"apple_oauth"),y=r(t,"farcaster"),h=r(t,"telegram"),A=e.mfa_methods.map((({type:e,verified_at:t})=>({type:e,verifiedAt:i(t)})));return{id:e.id,createdAt:i(e.created_at),linkedAccounts:t,email:l&&{address:l?.address},phone:n&&{number:n?.number},wallet:a&&{address:a.address,chainType:a.chainType,chainId:a.chainId,walletClient:a.walletClient,walletClientType:a.walletClientType,connectorType:a.connectorType,recoveryMethod:a.recoveryMethod,imported:a.imported,walletIndex:a.walletIndex},smartWallet:s&&{address:s.address,smartWalletType:s.smartWalletType},google:d&&{subject:d.subject,email:d.email,name:d.name},twitter:o&&{subject:o.subject,username:o.username,name:o.name,profilePictureUrl:o.profilePictureUrl},discord:u&&{subject:u.subject,username:u.username,email:u.email},github:f&&{subject:f.subject,username:f.username,name:f.name,email:f.email},spotify:c&&{subject:c.subject,email:c.email,name:c.name},instagram:p&&{subject:p.subject,username:p.username},tiktok:m&&{subject:m.subject,username:m.username,name:m.name},linkedin:_&&{subject:_.subject,name:_.name,email:_.email,vanityName:_.vanityName},apple:v&&{subject:v.subject,email:v.email},farcaster:y&&{fid:y.fid,ownerAddress:y.ownerAddress,displayName:y.displayName,username:y.username,bio:y.bio,pfp:y.pfp,url:y.url,signerPublicKey:y.signerPublicKey},telegram:h&&{telegramUserId:h.telegramUserId,firstName:h.firstName,lastName:h.lastName,username:h.username,photoUrl:h.photoUrl},mfaMethods:A.map((e=>e.type)),hasAcceptedTerms:e.has_accepted_terms??!1,isGuest:e.is_guest,customMetadata:e.custom_metadata}},exports.emitPrivyEvent=d,exports.getImportedPrivyEthereumWallet=e=>e?.linkedAccounts.find((e=>"wallet"===e.type&&"privy"===e.walletClientType&&e.imported&&"ethereum"===e.chainType))||null,exports.getPrivyEthereumHDWallets=e=>e?.linkedAccounts.filter((e=>"wallet"===e.type&&"privy"===e.walletClientType&&!e.imported&&"ethereum"===e.chainType)),exports.getPrivyEthereumWallet=a,exports.getPrivySolanaWallet=s,exports.getSigningAndRootWallet=(t,i)=>{let r=(s=t,s?.linkedAccounts.filter((e=>"wallet"===e.type&&"privy"===e.walletClientType&&"ethereum"===e.chainType))).find((t=>e.getAddress(t.address)===e.getAddress(i)));var s;return{signingWallet:r,rootWallet:r?r.imported?r:a(t):void 0}},exports.privyEventsDefault={login:{onComplete:[],onError:[],onOAuthLoginComplete:[]},logout:{onSuccess:[]},connectWallet:{onSuccess:[],onError:[]},createWallet:{onSuccess:[],onError:[]},linkAccount:{onSuccess:[],onError:[]},update:{onSuccess:[],onError:[]},configureMfa:{onMfaRequired:[]},setWalletPassword:{onSuccess:[],onError:[]},setWalletRecovery:{onSuccess:[],onError:[]},signMessage:{onSuccess:[],onError:[]},signTypedData:{onSuccess:[],onError:[]},sendTransaction:{onSuccess:[],onError:[]},sendSolanaTransaction:{onSuccess:[],onError:[]},accessToken:{onAccessTokenGranted:[],onAccessTokenRemoved:[]},oAuthAuthorization:{onOAuthTokenGrant:[]},fundWallet:{onUserExited:[]},fundSolanaWallet:{onUserExited:[]},customAuth:{onAuthenticated:[],onUnauthenticated:[]}},exports.shouldProceedtoEmbeddedWalletCreationFlow=(e,t)=>!(a(e)||s(e)||"all-users"!==t&&("users-without-wallets"!==t||(e=>e.linkedAccounts.filter((e=>"wallet"===e.type)))(e)?.length)),exports.useEmitPrivyEvent=function(){let e=n();return(t,i,...r)=>d(e,t,i,...r)},exports.usePrivyEventSubscription=function(e,i){if(!i)return;let r=n().current[e];return t.useEffect((()=>{for(let[t,a]of Object.entries(i))r.hasOwnProperty(t)||console.warn(`Invalid event type "${t}" for action "${e}"`),r[t]?.push(a);return()=>{for(let[t,a]of Object.entries(i))r.hasOwnProperty(t)||console.warn(`Invalid event type "${t}" for action "${e}"`),r[t]=r[t]?.filter((e=>e!==a))}}),[i])};
