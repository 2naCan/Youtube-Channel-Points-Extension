
# YouTube Channel Points Extension

This project is a browser extension that tracks users YouTube watch time per channel and rewards them with on-chain XP for watching creators. The watch time data is stored using **Supabase** and **Buildship** workflows, with the extension integrating **Privy** for authentication and wallet management.

## Project Overview

The extension captures the following data:
- **Video author**: The YouTube channel the user is watching.
- **Watch time**: How long the user spends watching a video.

This data is sent to a BuildShip workflow and logged in Supabase, allowing users to accumulate rewards based on their engagement. The rewards are provided as on-chain XP, making it easy to track and incentivize watch time.

## Key Technologies

- **Privy**: Used for user authentication, linking a user's watch history to their wallet and user ID.
- **Supabase**: Handles the backend database for storing users' watch time data.
- **Buildship Workflows**: Used for managing on-chain reward distribution based on watch time data.

## How It Works

1. **Track Watch Time**: The extension monitors the user's YouTube activity, capturing the amount of time spent watching each video.
2. **Log Watch Data**: The watch time data is processed and sent to a server using **Supabase**. Each entry includes the video author, the amount of time watched, and the user’s ID.
3. **Reward Users**: Based on the logged watch time, users earn on-chain XP via **Buildship**, which can be used to reward users for their engagement.


## Project Overview

```bash
ChannelPointsExtension/
├── .vscode/
│   ├── launch.json
│   └── settings.json
├── dist/
├── node_modules/
├── src/
│   ├── scripts/
│   │   └── content
│   │       └── App.tsx
│   │       └── index.tsx
│   │       └── youtubePlayerHook.js
│   │       └── YoutubeWatchTime.tsx
│   │   └── onInstalled
│   │       └── App.tsx
│   │       └── index.tsx
│   │       └── onInstalled.html
│   │   └── options
│   │       └── Options.tsx
│   │       └── index.tsx
│   │       └── options.html
│   │   └── popup
│   │       └── Popup.tsx
│   │       └── index.tsx
│   │       └── popup.html
│   │   └── service-worker
│   │       └── service-worker.tsx
│   ├── styles/
│   │   └── index.css
│   ├── utils/
│   │   └── browser.ts
│   ├── index.html
│   ├── manifest.ts # Generates Manifest.json
├── .gitignore
├── package.json
├── README.md
├── tsconfig.json
└── vite.config.ts
```
## Project Setup

Start by installing your dependencies as usual.

```bash
npm install
```
### Database setup

If you wish to use Supabase please follow their project setup here: https://supabase.com.
Below is the database structure I have used:
```sql
create table
  public."userWatchTime" (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone not null default now(),
    user_id text null,
    watch_time text null,
    author text null,
    wallet_address text null,
    last_rewarded_at text null,
    constraint userWatchTime_pkey primary key (id)
  ) tablespace pg_default;
```

### Buildship setup

In this project I have used Buildship for the data processing from the Supabase database. This is because they have pre-built templates and nodes to work with [Supabase](https://buildship.com/integrations/supabase) and [Openformat](https://buildship.com/integrations/openformat).

Buildship setup can be found [here](https://buildship.com/blog/introducing-buildship).
If you wish to follow my templates the workflows can be found here:

[Watch-time data handling](https://buildship.app/remix/13b33e98-f386-41de-b41a-003037474455)

[Reward handling](https://buildship.app/remix/1d340a39-0c57-426e-87db-9a0d02c677ad)

In order to link this code with your Buildship workflow **please replace line 26** within the service-worker with your Buildship Endpoint.

If you wish to do this all within the application, this code can be run within the service worker (src/scripts/service-worker/service-worker.ts) by following these two implementations.

[Supabase](https://supabase.com/docs/guides/getting-started/quickstarts/reactjs) 

[Openformat SDK](https://docs.openformat.tech/sdks/typescript/quickstart)

### OpenFormat setup
The guide for account setup and Buildship integration can be found [here](https://docs.openformat.tech/no-code/buildship/templates/reward-user-xp).

If you wish to do this locally please follow [this guide](https://docs.openformat.tech/sdks/typescript/quickstart) for Openformat's SDK

### Privy setup
In order to utilise the Privy log-in modal you will need to [create an account](https://www.privy.io) and a new App. Then use the Settings page > Basics tab of the dashboard to get your Privy app ID, app secret, and verification key.

Your Privy app ID should be **placed in line 37** of index.tsx (src/scripts/content/index.tsx)

## Building and Shipping 

To get the extension running on Chrome, you'll need to do a couple steps. Firstly, run the build command, which uses vite to build and output to the `dist` folder.

```bash
npm run build
```

From here, open Chrome and go to `chrome://extensions`, then hit `Load Unpacked` and choose the newly made `dist` directory.

You'll notice that `npm run build` calls on two vite configs, one for your `content` script, and another for everything else. The reasoning for this is that we're having to output two very different builds (a normal 'vite'-ish HTML build, and a library (the `content` script)).

## Running the Service-Worker 
Running this program will allow the background processes to deal with database submissions.
```bash
npm run dev
```

## Future Plans

- **Watch Stats Dashboard**: Create a user interface where users can view detailed statistics on their watch time, such as total hours watched per creator or time spent on specific content.
- **Leaderboards**: Implement global or community-based leaderboards where users can compare their watch time with others.
- **Achievements and Badges**: Introduce achievements or badges that users can unlock based on their watch time milestones, specific creators watched, or other unique metrics.
- **Improved UI**: Build the extension's interface, providing easy access to stats, achievements, and the reward system directly from the extension popup.
